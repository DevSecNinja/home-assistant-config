- id: '1598779260284'
  alias: Switch TV receiver to computer sound
  description: 'Automatically switches the living room receiver to play sound from
    your computer.

    Turns on the receiver and waits until it''s ready.

    '
  trigger:
  - entity_id: automation.enable_pc_audio_on_receiver
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    action: media_player.turn_on
    target:
      entity_id:
      - media_player.living_room_receiver_http
  - timeout: '5'
    wait_template: is_state(''media_player.living_room_receiver_http'', ''on'')
  - data:
      source: Denon
    entity_id: media_player.living_room_tv
    action: media_player.select_source
  - data:
      source: Media Player
    entity_id: media_player.living_room_receiver_http
    action: media_player.select_source
  - data:
      entity_id: automation.enable_pc_audio_on_receiver
    action: automation.turn_off
  mode: single
  initial_state: false
- id: '1651856970463'
  alias: Restart smart home system
  description: 'Restarts the entire smart home system when you press a button.

    Everything will reload and start fresh.

    '
  trigger:
  - platform: state
    entity_id:
    - input_button.restart_home_assistant
  condition: []
  action:
  - action: homeassistant.restart
    data: {}
  mode: single
- id: '1709450048502'
  alias: Alert when server uses too much power
  description: 'Sends a notification if the server uses more than 40W for 4 hours
    straight.

    This means the disks might not be powering down properly.

    '
  triggers:
  - entity_id:
    - sensor.shelly_nas_switch_0_power
    for:
      hours: 4
      minutes: 0
      seconds: 0
    above: 40
    trigger: numeric_state
  conditions: []
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: ⚡ NAS power too high
      message: 'Above 40W for 4 hours.

        Disks may not be sleeping.'
  mode: single
- id: '1720873118886'
  alias: Daily countdown reminder at 6am
  description: 'Every morning at 6am, sends you a message showing how many days are
    left

    for any active countdowns you''ve set up.

    '
  trigger:
  - platform: time
    at: 06:00:00
  condition: []
  action:
  - variables:
      now: '{{ as_timestamp(now()) }}'
      entity_id_1: input_datetime.countdown_timer_1
      entity_id_2: input_datetime.countdown_timer_2
      countdown_date_1: '{{ as_timestamp(states(entity_id_1)) }}'
      countdown_date_2: '{{ as_timestamp(states(entity_id_2)) }}'
      delta_1: '{{ (countdown_date_1 - now) // 86400 }}'
      delta_2: '{{ (countdown_date_2 - now) // 86400 }}'
      friendly_name_1: '{{ state_attr(entity_id_1, ''friendly_name'') }}'
      friendly_name_2: '{{ state_attr(entity_id_2, ''friendly_name'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ delta_1 > 0 or delta_2 > 0 }}'
      sequence:
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: Countdown Update
          message: "{% set messages = [] %} {% if delta_1 > 0 %}\n  {% set messages
            = messages + [friendly_name_1 ~ \": \" ~ delta_1 | int ~ \" days left\"]
            %}\n{% endif %} {% if delta_2 > 0 %}\n  {% set messages = messages + [friendly_name_2
            ~ \": \" ~ delta_2 | int ~ \" days left\"] %}\n{% endif %} {{ messages
            | join('\\n') }}\n"
- id: '1724168359521'
  alias: Turn on toilet light when you enter
  description: 'Automatically turns the toilet light on when you walk in,

    and turns it off after you leave. Uses dimmer light at night.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.toilet_motion
      light_switch:
        entity_id: light.toilet
      time_delay: 3
      night_lights_conditions:
      - sun_enabled
      include_night_lights: night_lights_enabled
      include_night_light_control:
      - use_brightness
      - use_transition
      night_lights:
        entity_id: light.toilet
      night_time_delay: 3
      night_light_transition_off: 5
      light_transition_off: 5
      light_brightness: 80
      include_light_control:
      - use_brightness
      - use_transition
      light_rgb_colour:
      - 255
      - 136
      - 13
      include_light_colour_control: use_colour_temperature
      include_night_light_colour_control: use_colour_temperature
      night_light_rgb_colour:
      - 255
      - 136
      - 13
      light_colour_temperature: 2700
      night_light_colour_temperature: 2700
      night_light_brightness: 10
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_toilet
- id: '1725698323949'
  alias: Turn on bathroom light when you enter
  description: 'Automatically turns the bathroom light on when you walk in,

    and turns it off after you leave. Uses dimmer light at night.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.bathroom_motion
      light_switch:
        entity_id: light.bathroom
      time_delay: 3
      night_lights_conditions:
      - sun_enabled
      include_night_lights: night_lights_enabled
      include_night_light_control:
      - use_brightness
      - use_transition
      night_lights:
        entity_id: light.bathroom
      night_time_delay: 3
      night_light_transition_off: 5
      light_transition_off: 5
      light_brightness: 80
      include_light_control:
      - use_brightness
      - use_transition
      light_rgb_colour:
      - 255
      - 152
      - 55
      include_light_colour_control: use_colour_temperature
      include_night_light_colour_control: use_colour_temperature
      night_light_rgb_colour:
      - 255
      - 152
      - 55
      light_colour_temperature: 2200
      night_light_colour_temperature: 2200
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_bathroom
- id: '1725699907962'
  alias: Turn on hall light when you walk by
  description: 'Automatically turns the hall light on when you walk through,

    and turns it off shortly after. Uses dimmer light at night.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.sensor_light_hall
      light_switch:
        entity_id: light.hall
      time_delay: 1
      night_lights_conditions:
      - sun_enabled
      include_night_lights: night_lights_enabled
      include_night_light_control:
      - use_brightness
      - use_transition
      night_lights:
        entity_id: light.hall
      night_time_delay: 1
      night_light_transition_off: 5
      light_transition_off: 5
      light_brightness: 80
      include_light_control:
      - use_brightness
      - use_transition
      light_rgb_colour:
      - 255
      - 136
      - 13
      include_light_colour_control: use_colour_temperature
      include_night_light_colour_control: use_colour_temperature
      night_light_rgb_colour:
      - 255
      - 136
      - 13
      light_colour_temperature: 2700
      night_light_colour_temperature: 2700
      night_lights_entity_state:
      - input_boolean.awake
      include_dynamic_lighting: enable_lux_controled_brightness
      dynamic_lighting_lux_sensor: sensor.living_room_window_illuminance
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_hall
      night_light_brightness: 15
      include_ambient: ambient_enabled
      ambient_light_options: ambient_light_option_enabled
      dynamic_lighting_min_lux: 100
      dynamic_lighting_max_brightness: 80
      dynamic_lighting_max_lux: 1200
      dynamic_lighting_min_brightness: 0
      ambient_light_sensor: sensor.hall_illuminance
- id: '1725701251585'
  alias: Weekly low battery check on Sundays
  description: 'Every Sunday morning at 9am, checks all your wireless devices.

    Sends a notification if any batteries are running low.

    '
  use_blueprint:
    path: Blackshome/low-battery-notifications-and-actions.yaml
    input:
      include_time: time_enabled
      time: 09:00:00
      weekday_options:
      - sun
      battery_level: 10
      include_easy_notify: enable_easy_notify
      notify_device:
      - 46543360583f3c2044f992f533f51051
      notify_interruption_level: passive
      exclude_sensors:
        entity_id:
        - sensor.hall_battery_plus
        - sensor.bedroom_battery_plus
        - sensor.bathroom_battery_plus
        - sensor.fuse_box_battery_plus
        - sensor.bathroom_battery_plus_2
        - sensor.living_room_battery_plus
        - sensor.living_room_battery_plus_2
        - sensor.kitchen_door_battery_plus
        - sensor.toilet_battery_plus
        - sensor.washing_room_battery_plus
        - sensor.bathroom_dimmer_battery_plus
        - sensor.dishwasher_leak_battery_plus
        - sensor.jean_paul_s_ipad_battery_plus
        - sensor.living_room_cube_battery_plus
        - sensor.jean_paul_s_iphone_battery_plus
        - sensor.living_room_dimmer_battery_plus
        - sensor.living_room_window_battery_plus
        - sensor.kitchen_smoke_alarm_battery_plus
        - sensor.bedroom_dimmer_battery_plus
        - sensor.bedroom_battery_plus_2
        - sensor.front_door_battery_plus
        - sensor.washing_machine_leak_battery_plus
        - sensor.living_room_workplace_switch_battery_plus
        - sensor.bedroom_window_battery_plus
        - sensor.living_room_window_battery_plus_2
        - sensor.ev6_ev_battery_level
        - binary_sensor.ev6_smart_key_battery_warning
        - binary_sensor.hall_battery_plus_low
        - binary_sensor.toilet_battery_plus_low
        - binary_sensor.bedroom_battery_plus_low
        - binary_sensor.bedroom_battery_plus_low_2
        - binary_sensor.bathroom_battery_plus_low
        - binary_sensor.bathroom_battery_plus_low_2
        - binary_sensor.fuse_box_battery_plus_low
        - binary_sensor.front_door_battery_plus_low
        - binary_sensor.living_room_battery_plus_low
        - binary_sensor.living_room_battery_plus_low_2
        - binary_sensor.kitchen_door_battery_plus_low
        - binary_sensor.washing_room_battery_plus_low
        - binary_sensor.bedroom_dimmer_battery_plus_low
        - binary_sensor.bedroom_window_battery_plus_low
        - binary_sensor.bathroom_dimmer_battery_plus_low
        - binary_sensor.dishwasher_leak_battery_plus_low
        - binary_sensor.jean_paul_s_ipad_battery_plus_low
        - binary_sensor.living_room_cube_battery_plus_low
        - binary_sensor.jean_paul_s_iphone_battery_plus_low
        - binary_sensor.living_room_dimmer_battery_plus_low
        - binary_sensor.living_room_window_battery_plus_low
        - binary_sensor.living_room_window_battery_plus_low_2
        - binary_sensor.kitchen_smoke_alarm_battery_plus_low
        - binary_sensor.washing_machine_leak_battery_plus_low
        - binary_sensor.living_room_workplace_switch_battery_plus_low
- id: '1725710736258'
  alias: Alert and disconnect power if leak detected
  description: 'If water leak is detected near the washing machine, immediately cuts
    power

    to prevent damage. Sends urgent notification to your phone.

    '
  use_blueprint:
    path: Blackshome/state-notifications-and-actions.yaml
    input:
      start_trigger_state: 'on'
      start_trigger_state_entity:
      - binary_sensor.washing_machine_leak_moisture
      start_notify_device:
      - 46543360583f3c2044f992f533f51051
      - 3a8b570c2364844265d6b63628d76f16
      include_start_notify: enable_start_notify_options
      start_title: "\U0001F4A7 Washing machine leak"
      start_message: '{{ states[trigger.entity_id].attributes.friendly_name }} leaking.
        Power turning off now.'
      start_notify_interruption_level: critical
      start_action_1:
      - repeat:
          sequence:
          - action: switch.turn_off
            metadata: {}
            data: {}
            target:
              entity_id: switch.washing_machine_smart_plug
          - delay:
              hours: 0
              minutes: 0
              seconds: 3
              milliseconds: 0
          while:
          - condition: or
            conditions:
            - condition: state
              entity_id: switch.washing_machine_smart_plug
              state: 'on'
            - condition: state
              entity_id: switch.washing_machine_smart_plug
              state: unavailable
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F50C {{ states[trigger.entity_id].attributes.friendly_name
            }} off"
          message: Turn power back on after fixing.
          data:
            push:
              interruption-level: critical
      - action: notify.mobile_app_jean_paul_van_ravensbergs_ipad
        data:
          title: "\U0001F50C {{ states[trigger.entity_id].attributes.friendly_name
            }} off"
          message: Turn power back on after fixing.
          data:
            push:
              interruption-level: critical
      include_start_auto_actions:
      - enable_start_action_1
      include_end_notify: disable_end_notify_options
      end_notify_device:
      - 46543360583f3c2044f992f533f51051
      - 3a8b570c2364844265d6b63628d76f16
      end_title: ✅ Leak stopped
      end_message: '{{ states[trigger.entity_id].attributes.friendly_name }} looks
        dry. Turn power back on.'
      end_notify_interruption_level: critical
      end_trigger_state: 'off'
      end_trigger_state_entity:
      - binary_sensor.washing_machine_leak_moisture
      global_conditions: []
- id: '1725714559016'
  alias: Alert if dishwasher leak detected
  description: 'If water leak is detected near the dishwasher, sends an urgent notification

    to your phone so you can take action quickly.

    '
  use_blueprint:
    path: Blackshome/state-notifications-and-actions.yaml
    input:
      start_trigger_state: 'on'
      start_trigger_state_entity:
      - binary_sensor.dishwasher_leak_moisture
      start_notify_device:
      - 3a8b570c2364844265d6b63628d76f16
      - 46543360583f3c2044f992f533f51051
      include_start_notify: enable_start_notify_options
      start_title: "\U0001F4A7 Dishwasher leak"
      start_message: '{{ states[trigger.entity_id].attributes.friendly_name }} leaking!
        Check it immediately.'
      start_notify_interruption_level: critical
      start_action_1: []
      include_start_auto_actions: []
      include_end_notify: disable_end_notify_options
      end_notify_device:
      - 3a8b570c2364844265d6b63628d76f16
      - 46543360583f3c2044f992f533f51051
      end_title: ✅ Leak stopped
      end_message: '{{ states[trigger.entity_id].attributes.friendly_name }} looks
        dry. Turn power back on.'
      end_notify_interruption_level: critical
      end_trigger_state: 'off'
      end_trigger_state_entity:
      - binary_sensor.dishwasher_leak_moisture
- id: '1726315782295'
  alias: Daily backup at 1am with monthly cleanup
  description: 'Creates a backup of your smart home setup every night at 1am.

    Old backups are automatically removed to save space.

    '
  use_blueprint:
    path: mdeweerd/backup_znp.yaml
    input:
      backup_time: 01:00:00
- id: '1726588601617'
  alias: Alert when front door opens
  description: 'Sends notification whenever the front door opens.

    Shows current alarm status and gives you quick buttons to arm or disarm.

    '
  triggers:
  - entity_id:
    - binary_sensor.front_door_opening
    to: 'on'
    trigger: state
    id: front-door-open
  conditions: []
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      message: request_location_update
    alias: Force iOS Location Update
  - action: notify.notify
    metadata: {}
    data:
      title: ⚠️ Front door opened
      message: 'Alarm: {{ states(''alarm_control_panel.alarmo'') }}'
      data:
        actions:
        - action: ALARMO_DISARM
          title: Disarm
          icon: sfsymbols:bell.slash.fill
          authenticationRequired: true
          destructive: true
        - action: ALARMO_ARM_AWAY
          title: Arm Away
          icon: sfsymbols:lock.fill
          authenticationRequired: true
        - action: ALARMO_ARM_HOME
          title: Arm Home
          icon: sfsymbols:house.fill
          authenticationRequired: true
        - action: ALARMO_ARM_VACATION
          title: Arm Vacation
          icon: sfsymbols:sun.min.fill
          authenticationRequired: true
  mode: single
- id: '1726648274903'
  alias: Control living room with dimmer remote
  description: 'Lets you control the living room lights and music using the wireless
    dimmer.

    Press buttons to turn lights on/off, pause music, or dim the lights.

    '
  use_blueprint:
    path: sandervv/ZHA - Hue Dimmer Fully Configurable.yaml
    input:
      remote: 357be757f3e7423296d4287e7c044113
      button_on_short_press:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.living_room
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.pause_the_automation_living_room_light
      button_off_short_press:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:30:00
        target:
          entity_id: timer.pause_the_automation_living_room_light
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        - condition: state
          entity_id: media_player.living_room_receiver_http
          attribute: source
          state: HEOS Music
        - condition: state
          entity_id: media_player.living_room_tv
          state: 'off'
        then:
        - action: media_player.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: media_player.living_room_receiver_http
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.living_room
- id: '1726648299745'
  alias: Control bedroom with dimmer remote
  description: 'Lets you control bedroom lights and music using the wireless dimmer.

    Different buttons play music, adjust brightness, or turn everything off.

    '
  use_blueprint:
    path: sandervv/ZHA - Hue Dimmer Fully Configurable.yaml
    input:
      remote: ab27ab06c2984b10ab36dc74befa6c07
      button_on_short_press:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.bedroom
      button_down_short_press:
      - if:
        - condition: state
          entity_id: media_player.bedroom
          state: playing
        then:
        - action: media_player.media_pause
          metadata: {}
          data: {}
          target:
            entity_id: media_player.bedroom
        else:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 85
            transition: 2
          target:
            entity_id: light.bedroom
        - action: script.play_spotify_playlist
          metadata: {}
          data:
            media_player: media_player.bedroom
      button_off_short_press:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 2
        target:
          entity_id: light.all_lights
      button_up_short_press:
      - action: script.wake_up_good_night
        metadata: {}
        data: {}
      button_on_long_press:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_step_pct: 10
        target:
          entity_id: light.bedroom
      button_off_long_press:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_step_pct: -10
        target:
          entity_id: light.bedroom
- id: '1726661632133'
  alias: Turn on alarm when going to sleep
  description: 'When you mark yourself as not awake (going to bed), automatically
    turns on

    the alarm in home mode to protect the house while you sleep.

    '
  triggers:
  - entity_id:
    - input_boolean.awake
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  actions:
  - action: alarmo.arm
    data:
      mode: home
      skip_delay: false
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1726661669538'
  alias: Turn off alarm when waking up
  description: 'When you mark yourself as awake in the morning, automatically turns
    off

    the alarm so you can move around the house freely.

    '
  trigger:
  - platform: state
    entity_id:
    - input_boolean.awake
    to: 'on'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      attribute: arm_mode
      state: disarmed
  action:
  - action: alarmo.disarm
    data:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1726764794273'
  alias: Turn on alarm when leaving home
  description: 'Automatically arms the alarm in away mode when you leave the house.

    Sends notification confirming the alarm is being activated.

    '
  triggers:
  - trigger: state
    entity_id:
    - person.jean_paul
    from: home
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  actions:
  - action: alarm_control_panel.alarm_arm_away
    target:
      entity_id: alarm_control_panel.alarmo
    data: {}
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F512 Arming alarm now"
      message: You left home.
  mode: single
- id: '1726841337575'
  alias: Alert if server stays on for 24 hours
  description: 'If server power doesn''t drop below 18W for 24 hours, sends alert.

    This means the disks aren''t powering off as they should.

    '
  triggers:
  - entity_id:
    - sensor.shelly_nas_switch_0_power
    for:
      hours: 24
      minutes: 0
      seconds: 0
    above: 18
    trigger: numeric_state
  conditions: []
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ⚡ NAS power still high
      message: 'Stayed above 18W for 24 hours.

        Check if disks are sleeping.'
  mode: single
- id: '1726863777053'
  alias: Send vacuum home when you arrive
  description: 'If the robot vacuum is cleaning when you get home,

    it automatically returns to its dock so it''s out of your way.

    '
  triggers:
  - entity_id:
    - person.jean_paul
    to: home
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: vacuum.roborock_s4
      state: cleaning
    then:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Move back to the dock
      target:
        entity_id: input_select.vacuum_room
  mode: single
- id: '1726864691758'
  alias: Mark as awake when you enter living room
  description: 'Between 6am-noon, if you enter the living room while marked as asleep,

    automatically marks you awake and turns off bedroom/bathroom lights.

    '
  triggers:
  - entity_id: binary_sensor.living_room_occupancy
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.awake
    state: 'off'
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_vacation
  - condition: time
    after: 06:00:00
    before: '12:00:00'
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.awake
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.bedroom
      - light.bathroom
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.bedroom
  - entity_id: media_player.living_room_tv
    action: media_player.turn_on
    enabled: false
  - wait_template: '{{ is_state(''media_player.living_room_tv'', ''on'') }}'
    timeout: '100'
    continue_on_timeout: false
    enabled: false
  - data:
      entity_id: media_player.living_room_tv
      source: LiveTV
    action: media_player.select_source
    enabled: false
  - wait_template: '{{ state_attr(''media_player.living_room_tv'', ''source'') ==
      ''LiveTV'' }}'
    timeout: '100'
    continue_on_timeout: false
    enabled: false
  - data:
      entity_id: media_player.living_room_tv
      media:
        media_content_id: NPO 1 HD
        media_content_type: channel
        metadata: {}
    action: media_player.play_media
    enabled: false
  - wait_template: '{{ is_state(''media_player.living_room_receiver_http'', ''on'')
      }}'
    timeout: '120'
    continue_on_timeout: false
    enabled: false
  - data:
      volume_level: 0.67
    action: media_player.volume_set
    target:
      entity_id: media_player.living_room_receiver_http
    enabled: false
- id: '1726865570805'
  alias: Pause music when TV turns on
  description: 'When you turn on the TV and music is playing through the receiver,

    automatically pauses the music and switches to TV sound.

    '
  trigger:
  - platform: state
    entity_id:
    - media_player.living_room_tv
    to: home
  condition:
  - condition: template
    value_template: '{{ not is_state(''media_player.spotify_jptjee'', ''paused'')
      }}'
  - condition: template
    value_template: '{% set receiver = states.media_player.living_room_receiver_http
      %} {{ receiver.attributes.source == ''HEOS Music'' if receiver else false }}

      '
  action:
  - action: media_player.media_pause
    target:
      entity_id: media_player.spotify_jptjee
  - action: media_player.select_source
    target:
      entity_id: media_player.living_room_receiver_http
    data:
      source: TV Audio
  mode: single
- id: '1726865981559'
  alias: Pause bedroom music when window opens
  description: 'When you open the bedroom window, automatically pauses the music

    so it doesn''t disturb neighbors or waste sound outside.

    '
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.bedroom_window_opening
    to: 'on'
  condition: []
  action:
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.bedroom
  mode: single
- id: '1726866070872'
  alias: Stop music if window already open
  description: 'If music starts playing while the bedroom window is already open,

    immediately pauses it to avoid disturbing neighbors.

    '
  trigger:
  - platform: state
    entity_id:
    - media_player.bedroom
    to: playing
  condition:
  - condition: state
    entity_id: binary_sensor.bedroom_window_opening
    state: 'on'
  action:
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.bedroom
  mode: single
- id: '1726867335951'
  alias: Daily bread reminder before lunch
  description: 'Every day at 10:58am, reminds you to take bread out of the freezer

    if you''re home. Doesn''t send reminders during vacation.

    '
  triggers:
  - at: '10:58:00'
    trigger: time
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_vacation
  - condition: or
    conditions:
    - condition: state
      entity_id: person.jean_paul
      state: home
    - condition: zone
      entity_id: device_tracker.jjr91v_device_tracker
      zone: zone.girlfriend
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F35E Bread reminder"
      message: Take bread out of freezer.
  mode: single
- id: '1726903549680'
  alias: Create full backup when requested
  description: 'Creates a complete backup of your smart home setup

    whenever you turn on the ''Backup Now'' button.

    '
  triggers:
  - entity_id: input_boolean.backup_trigger
    to: 'on'
    trigger: state
  - at: 01:00:00
    trigger: time
    enabled: false
  actions:
  - entity_id: input_boolean.backup_trigger
    action: input_boolean.turn_off
  - action: backup.create_automatic
    metadata: {}
    data: {}
- id: '1726904067295'
  alias: Turn off TV when receiver turns off
  description: 'If you turn off the receiver and the TV is still on,

    automatically turns off the TV too. Saves power.

    '
  trigger:
  - platform: state
    entity_id: media_player.living_room_receiver_http
    to: 'off'
  condition:
  - condition: state
    entity_id: media_player.living_room_tv
    state: 'on'
  action:
  - target:
      entity_id: media_player.living_room_tv
    action: media_player.turn_off
- id: '1726904281464'
  alias: Reset vacuum maintenance reminders
  description: 'After you clean or replace vacuum parts (filter, brushes, sensors),

    resets the timer so it won''t remind you again for a while.

    '
  trigger:
  - platform: state
    entity_id: input_select.vacuum_reset_maintenance
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.vacuum_reset_maintenance
        state: Sensors
      sequence:
      - target:
          entity_id:
          - vacuum.roborock_s4
        data:
          command: reset_consumable
          params:
          - sensor_dirty_time
        action: vacuum.send_command
    - conditions:
      - condition: state
        entity_id: input_select.vacuum_reset_maintenance
        state: Filter
      sequence:
      - target:
          entity_id:
          - vacuum.roborock_s4
        data:
          command: reset_consumable
          params:
          - filter_work_time
        action: vacuum.send_command
    - conditions:
      - condition: state
        entity_id: input_select.vacuum_reset_maintenance
        state: Main Brush
      sequence:
      - target:
          entity_id:
          - vacuum.roborock_s4
        data:
          command: reset_consumable
          params:
          - main_brush_work_time
        action: vacuum.send_command
    - conditions:
      - condition: state
        entity_id: input_select.vacuum_reset_maintenance
        state: Side Brush
      sequence:
      - target:
          entity_id:
          - vacuum.roborock_s4
        data:
          command: reset_consumable
          params:
          - side_brush_work_time
        action: vacuum.send_command
  - action: input_select.select_option
    metadata: {}
    data:
      option: Select a maintenance task...
    target:
      entity_id: input_select.vacuum_reset_maintenance
- id: '1726904442852'
  alias: Turn on toothbrush charger at 2am
  description: 'Every night at 2am, turns on power to the electric toothbrush

    so it charges overnight. Skips this when on vacation.

    '
  triggers:
  - at: 02:00:00
    trigger: time
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_vacation
  actions:
  - action: switch.turn_on
    target:
      entity_id:
      - switch.bathroom_toothbrush_switch
    data: {}
- id: '1726904466889'
  alias: Turn off toothbrush charger at 5am
  description: 'Every morning at 5am, turns off power to the electric toothbrush.

    Gives it a 3-hour charging window each night.

    '
  triggers:
  - at: 05:00:00
    trigger: time
  actions:
  - action: switch.turn_off
    data: {}
    target:
      entity_id: switch.bathroom_toothbrush_switch
- id: '1726904965492'
  alias: Adjust everything for vacation mode
  description: 'When vacation mode turns on: disables alarms, lights, and cleaning
    schedules.

    When you return home: re-enables everything and welcomes you back.

    '
  triggers:
  - entity_id:
    - alarm_control_panel.alarmo
    attribute: arm_mode
    from: armed_vacation
    trigger: state
  - entity_id:
    - alarm_control_panel.alarmo
    attribute: arm_mode
    to: armed_vacation
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_vacation
        attribute: arm_mode
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.wakeup_enabled
          - input_boolean.awake
          - input_boolean.vacuum_clean_enabled
        data: {}
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.bathroom_toothbrush_switch
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.all_lights
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F334 Vacation mode on"
          message: Enjoy! Alarm and automation paused.
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: alarm_control_panel.alarmo
          attribute: arm_mode
          state: armed_vacation
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id:
          - input_boolean.wakeup_enabled
          - input_boolean.awake
          - input_boolean.vacuum_clean_enabled
        data: {}
      - action: switch.turn_on
        metadata: {}
        target:
          entity_id: switch.bathroom_toothbrush_switch
        data: {}
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F3E0 Welcome home"
          message: 'Automations restored.

            Next alarm: {{ states(''input_datetime.wakeup_time'') }}.'
- id: '1726906598387'
  alias: Turn on desktop computer remotely
  description: 'When you press the wake up button, sends a signal

    to turn on your desktop computer over the network.

    '
  trigger:
  - platform: state
    entity_id: input_boolean.wake_up_desktop
    from: 'off'
    to: 'on'
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.wake_on_lan_desktop
  - wait_template: '{{ is_state(''switch.wake_on_lan_desktop'', ''on'') }}'
    timeout: 00:00:30
    continue_on_timeout: true
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.wake_up_desktop
- id: '1726906770932'
  alias: Switch receiver to computer audio mode
  description: 'When you press the button, switches the receiver to play sound from
    computer.

    Sends reminder to add the second screen and change computer audio output.

    '
  trigger:
  - platform: state
    entity_id: input_button.enable_pc_audio_on_receiver
  action:
  - action: media_player.turn_on
    target:
      entity_id: media_player.living_room_receiver_http
    data: {}
  - wait_template: '{{ not is_state(''media_player.living_room_receiver_heos'', ''off'')
      }}'
    timeout: 00:02:00
    continue_on_timeout: false
  - action: media_player.select_source
    target:
      entity_id: media_player.living_room_receiver_heos
    data:
      source: Media Player
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001F509 Receiver set to PC"
      message: 'Remember: add screen 2 and change output.'
- id: '1726907061543'
  alias: Turn off entertainment when leaving home
  description: 'When you leave or arm the alarm, checks if TV, receiver, or music
    is on.

    Turns off what''s running and sends notification that it saved you money.

    '
  triggers:
  - entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
    event: leave
    trigger: zone
  - entity_id:
    - alarm_control_panel.alarmo
    attribute: arm_mode
    from: disarmed
    trigger: state
  - trigger: state
    entity_id:
    - person.jean_paul
    from:
    - home
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_home
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_night
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.living_room_tv
        state: 'on'
      sequence:
      - action: media_player.turn_off
        target:
          entity_id: media_player.living_room_tv
        data: {}
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F4FA TV turned off"
          message: Saving power while you're away.
    - conditions:
      - condition: state
        entity_id: media_player.living_room_receiver_http
        state: 'on'
      sequence:
      - action: media_player.turn_off
        target:
          entity_id: media_player.living_room_receiver_http
        data: {}
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F50A Receiver turned off"
          message: Saving power while you're away.
    - conditions:
      - condition: state
        entity_id: media_player.bedroom
        state: playing
      sequence:
      - action: media_player.media_pause
        target:
          entity_id: media_player.bedroom
        data: {}
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F3B5 Music paused"
          message: Saving power while you're away.
  - action: light.turn_off
    data: {}
    target:
      entity_id: light.all_lights
- id: '1726954321977'
  alias: Control workplace music with wireless button
  description: 'Round wireless button near workplace: single press plays/pauses music,

    double press resumes, triple press switches device, long press wakes computer.

    '
  use_blueprint:
    path: carlosmesquita/zha-xiaomi-mijia-round-wireless-switch-wxkg01lm-lumi-sensor-switch.yaml
    input:
      mijia_round_switch: 6453cf48ee1b455ba82a7dd5c29530c9
      remote_button_short_press:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: media_player.spotify_jptjee
            state: playing
        then:
        - action: script.play_spotify_playlist
          metadata: {}
          data:
            media_player: media_player.living_room_receiver_http
        else:
        - action: media_player.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: media_player.living_room_receiver_http
      remote_button_triple_press:
      - action: script.play_spotify_playlist
        metadata: {}
        data:
          media_player: media_player.spotify_jptjee
      remote_button_hold_press:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.wake_up_desktop
      remote_button_double_press:
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        then:
        - action: media_player.media_pause
          metadata: {}
          data: {}
          target:
            entity_id: media_player.spotify_jptjee
        else:
        - action: media_player.select_source
          metadata: {}
          data:
            source: Living Room Receiver
          target:
            entity_id: media_player.spotify_jptjee
        - action: media_player.media_play
          metadata: {}
          data: {}
          target:
            entity_id: media_player.spotify_jptjee
- id: '1726955288158'
  alias: Control music with smart cube
  description: 'Shake to play/pause, drop to turn off/play, flip for next song,

    rotate clockwise/counter to adjust volume, flip 180° for previous song.

    '
  use_blueprint:
    path: SirGoodenough/ZHA-Xiaomi_Cube_Controller.yaml
    input:
      last_side_input: input_number.xiaomi_magic_cube_last_side_up_helper
      cube: cd17ae5cc24c46daa31f1f53c5a3682d
      shake:
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        then:
        - action: media_player.media_play_pause
          target:
            entity_id: media_player.spotify_jptjee
          data: {}
        else:
        - action: media_player.select_source
          metadata: {}
          data:
            source: Living Room
          target:
            entity_id: media_player.spotify_jptjee
        - action: media_player.media_play
          metadata: {}
          data: {}
          target:
            entity_id: media_player.spotify_jptjee
      drop:
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        then:
        - action: media_player.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: media_player.living_room_receiver_http
        else:
        - action: script.play_spotify_playlist
          metadata: {}
          data:
            media_player: media_player.living_room_receiver_heos
      flipped90_any:
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        then:
        - action: media_player.media_next_track
          metadata: {}
          data: {}
          target:
            entity_id: media_player.spotify_jptjee
      rotate_cw_any:
      - action: media_player.volume_set
        target:
          entity_id:
          - media_player.living_room_receiver_http
        data:
          volume_level: '{{ state_attr(''media_player.living_room_receiver_http'',
            ''volume_level'') + 0.02 }}'
      rotate_ccw_any:
      - action: media_player.volume_set
        target:
          entity_id:
          - media_player.living_room_receiver_http
        data:
          volume_level: '{{ state_attr(''media_player.living_room_receiver_http'',
            ''volume_level'') - 0.02 }}'
      flipped180_any:
      - if:
        - condition: state
          entity_id: media_player.spotify_jptjee
          state: playing
        then:
        - action: media_player.media_previous_track
          target:
            entity_id:
            - media_player.spotify_jptjee
          data: {}
- id: '1727118356540'
  alias: Alert for low-flying aircraft nearby
  description: 'When you''re home and a plane flies overhead below 10,000 feet,

    sends notification with flight details and photo of the aircraft.

    '
  trigger:
  - platform: event
    event_type: flightradar24_entry
  condition:
  - condition: state
    entity_id: device_tracker.jeanpaulsiphone
    state: home
  - condition: template
    value_template: '{{ trigger.event.data.altitude < 10000 }}'
  action:
  - data:
      message: ✈️ {{ trigger.event.data.callsign }} ({{ trigger.event.data.airline
        }}) to {{ trigger.event.data.airport_destination_city }} from {{ trigger.event.data.airport_origin_city
        }}
      data:
        url: https://fr24.com/{{ trigger.event.data.callsign }}/{{ trigger.event.data.id
          }}
        image: '{{ trigger.event.data.aircraft_photo_medium }}'
    action: notify.mobile_app_jean_pauls_iphone
- id: '1727378847793'
  alias: Start vacuum when room is selected
  description: 'When you select a room from the menu, immediately starts

    the robot vacuum to clean that specific room.

    '
  trigger:
  - platform: state
    entity_id:
    - input_select.vacuum_room
    from: Select a room...
  condition: []
  action:
  - action: script.run_vacuum_cleaner
    metadata: {}
    data:
      variables:
        rooms: '{{ states(''input_select.vacuum_room'') }}'
  mode: single
- id: '1727515667258'
  alias: Sync alarm time with bedroom speaker
  description: 'Whenever you change your wakeup time or turn alarm on/off,

    automatically updates the bedroom speaker alarm to match.

    '
  trigger:
  - platform: state
    entity_id:
    - input_datetime.wakeup_time
  - platform: state
    entity_id:
    - input_boolean.wakeup_enabled
  condition: []
  action:
  - action: sonos.update_alarm
    metadata: {}
    data:
      alarm_id: 1
      enabled: '{{ is_state(''input_boolean.wakeup_enabled'', ''on'') }}'
      time: '{{ state_attr(''input_datetime.wakeup_time'', ''timestamp'') | timestamp_custom(''%H:%M:%S'',
        false) }}'
      entity_id: media_player.bedroom
  mode: single
- id: '1727516172708'
  alias: Switch playlist when selection changes
  description: 'When you select a different playlist from the menu,

    automatically starts playing that playlist on the receiver.

    '
  trigger:
  - platform: state
    entity_id:
    - input_select.spotify_playlist
  condition: []
  action:
  - action: script.play_spotify_playlist
    metadata: {}
    data:
      media_player: media_player.living_room_receiver_http
      playlist: '{{ states(''input_select.spotify_playlist'') }}'
  mode: single
- id: '1727516578007'
  alias: Friday morning washing machine power reminder
  description: 'Every Friday at 4am, turns on washing machine power and sends reminder.

    After 5 hours, checks if you started it and sends second reminder if not.

    '
  triggers:
  - at: 04:00:00
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: time
      weekday:
      - fri
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_home
  actions:
  - action: switch.turn_on
    target:
      entity_id: switch.washing_machine_smart_plug
    data: {}
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001F4A7 Washing machine ready"
      message: Power is on. Use it today!
  - delay:
      hours: 5
      minutes: 0
      seconds: 0
      milliseconds: 0
  - if:
    - condition: numeric_state
      entity_id: sensor.washing_machine_smart_plug_current_consumption
      below: 10
    then:
    - action: notify.mobile_app_jean_pauls_iphone
      data:
        message: Looks like the washing machine isn’t running yet!
        title: Washing Machine Reminder
- id: '1727516604683'
  alias: Sunday morning washing machine power off
  description: 'Every Sunday at 2am, if washing machine isn''t running,

    turns off the power and sends notification.

    '
  triggers:
  - at: 02:00:00
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: time
      weekday:
      - sun
    - condition: numeric_state
      entity_id: sensor.washing_machine_smart_plug_current_consumption
      below: 10
  actions:
  - action: switch.turn_off
    target:
      entity_id: switch.washing_machine_smart_plug
    data: {}
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001F4A7 Power turned off"
      message: Washing machine is off.
- id: '1727516942520'
  alias: Turn off receiver after 5 minutes idle
  description: 'If music is paused for 5 minutes with TV off, turns off the receiver

    automatically. Sends reminder not to leave it on.

    '
  trigger:
  - platform: time_pattern
    minutes: /1
  condition:
  - condition: state
    entity_id: media_player.living_room_receiver_heos
    state: paused
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - condition: state
    entity_id: media_player.living_room_receiver_http
    state: HEOS Music
    for:
      hours: 0
      minutes: 0
      seconds: 0
    attribute: source
  - condition: state
    entity_id: media_player.living_room_tv
    state: 'off'
  action:
  - action: media_player.turn_off
    target:
      entity_id: media_player.living_room_receiver_http
    data: {}
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F4B0 Receiver turned off"
      message: Saving power. It was idle.
- id: '1727517745909'
  alias: Scheduled vacuum cleaning when away
  description: 'At your set time, if you''re awake and not home, automatically starts

    the vacuum to clean. Won''t run if you''re home or asleep.

    '
  trigger:
  - platform: time
    at: input_datetime.vacuum_clean_time
  condition:
  - condition: state
    entity_id: input_boolean.vacuum_clean_enabled
    state: 'on'
  - condition: state
    entity_id: input_boolean.awake
    state: 'on'
  - condition: not
    conditions:
    - condition: zone
      entity_id: device_tracker.jean_pauls_iphone_app
      zone: zone.home
  action:
  - action: script.run_vacuum_cleaner
    metadata: {}
    data:
      rooms: Living Room & Kitchen
  mode: single
- id: '1727517990211'
  alias: Clean while you shower
  description: 'When you turn on the shower and you''re awake, starts vacuuming

    the living room and kitchen so it''s done when you finish.

    '
  triggers:
  - entity_id:
    - input_boolean.bathroom_shower
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.awake
    state: 'on'
  actions:
  - action: script.run_vacuum_cleaner
    metadata: {}
    data:
      rooms: Living Room & Kitchen
    enabled: false
  - action: input_select.select_option
    metadata: {}
    data:
      option: Living Room & Kitchen
    target:
      entity_id: input_select.vacuum_room
- id: '1727518568203'
  alias: Sunday vacuum maintenance reminder
  description: 'Every Sunday at 10am, if you''re home, checks which vacuum parts need
    cleaning

    (brush, sensors, filter) and sends reminder if any need attention.

    '
  trigger:
  - platform: time
    at: '10:00:00'
  condition:
  - condition: time
    weekday:
    - sun
  - condition: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
  action:
  - variables:
      message_list: "{% set messages = [] %} {% if states('sensor.roborock_s4_main_brush_left')
        | int <= 0 %}\n  {% set messages = messages + ['main brush'] %}\n{% endif
        %} {% if states('sensor.roborock_s4_sensor_dirty_left') | int <= 0 %}\n  {%
        set messages = messages + ['sensors'] %}\n{% endif %} {% if states('sensor.roborock_s4_side_brush_left')
        | int <= 0 %}\n  {% set messages = messages + ['side brush'] %}\n{% endif
        %} {% if states('sensor.roborock_s4_filter_left') | int <= 0 %}\n  {% set
        messages = messages + ['filter'] %}\n{% endif %} {{ messages | join(', ')
        }}\n"
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ message_list != '''' }}'
      sequence:
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: "\U0001F916 Vacuum needs attention"
          message: 'Clean these: {{ message_list }}'
- id: '1727519498913'
  alias: Washing machine start and finish alerts
  description: 'Notifies you when washing machine starts and when it finishes.

    Shows how long it took and approximate cost of the wash.

    '
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      power_sensor: sensor.washing_machine_smart_plug_current_consumption
      end_appliance_power: 10
      include_start_notify: enable_start_notify_options
      start_notify_device:
      - 46543360583f3c2044f992f533f51051
      start_title: "\U0001F4A7 Washing started"
      start_message: Machine is running.
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - 46543360583f3c2044f992f533f51051
      end_message_title: "\U0001F4A7 Washing done"
      power_consumption_sensor: sensor.washing_machine_smart_plug_total_consumption
      include_power_tracking: enable_power_tracking_and_cost
      end_message_cost: Approx Cost €
      cost_per_kwh: sensor.greenchoice_electricity_price_high
      start_power_consumption: input_number.helper_washing_machine_power_start_number
      end_power_consumption: input_number.helper_washing_machine_power_end_number
      include_duration_tracking: enable_duration_tracking
      start_appliance_power: 7
      include_custom_actions:
      - enable_start_custom_actions
      start_custom_actions:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.washing_machine
      end_custom_actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.washing_machine
- id: '1727525959760'
  alias: URGENT alert if smoke detected
  description: 'If the smoke alarm goes off in the kitchen,

    sends critical urgent notification to your phone immediately.

    '
  trigger:
  - platform: state
    entity_id:
    - siren.kitchen_smoke_alarm_siren
    to: 'on'
  condition: []
  action:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F525 Smoke detected"
      message: "\U0001F692"
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
  mode: single
- id: '1727526449921'
  alias: Daily toothbrush reminder at 12:55pm
  description: 'If you''re home at 12:55pm, reminds you to brush your teeth.

    Sends second reminder 30 minutes later if you haven''t gone to bathroom.

    '
  triggers:
  - at: '12:55:00'
    trigger: time
  conditions:
  - condition: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: disarmed
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_home
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001FAA5 Brush your teeth"
      message: Take a quick break.
  - wait_for_trigger:
    - entity_id:
      - binary_sensor.bathroom_motion
      to: 'on'
      trigger: state
    continue_on_timeout: true
    timeout:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - if:
    - condition: zone
      entity_id: device_tracker.jean_pauls_iphone_app
      zone: zone.home
    then:
    - action: notify.mobile_app_jean_pauls_iphone
      metadata: {}
      data:
        title: "\U0001FAA5 Reminder: brush teeth"
        message: Still haven't brushed. Do it now.
  mode: single
- id: '1727527052759'
  alias: Bedroom airing done after 15 minutes
  description: 'After bedroom window is open for 15 minutes, reminds you to close
    it.

    Won''t send repeated reminders within 3 hours.

    '
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.bedroom_window_opening
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  condition:
  - condition: template
    value_template: "{% set last_triggered = state_attr('automation.notify_if_bedroom_window_is_open_for_15_minutes',
      'last_triggered') %} {% if last_triggered is none %}\n  true\n{% else %}\n  {{
      (now() - last_triggered).total_seconds() / 3600.0 >= 3 }}\n{% endif %}\n"
  action:
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001FA9F Close bedroom window"
      message: Open for 15 minutes.
- id: '1727527131896'
  alias: Living room airing done after 15 minutes
  description: 'After living room window is open for 15 minutes, reminds you to close
    it.

    Won''t send repeated reminders within 3 hours.

    '
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.living_room_window_opening
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  condition:
  - condition: template
    value_template: "{% set last_triggered = state_attr('automation.notify_if_living_room_window_is_open_for_15_minutes',
      'last_triggered') %} {% if last_triggered is none %}\n  true\n{% else %}\n  {{
      (now() - last_triggered).total_seconds() / 3600.0 >= 3 }}\n{% endif %}\n"
  action:
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001FA9F Close living room window"
      message: Open for 15 minutes.
- id: '1727527258915'
  alias: Warning if fuse box gets too hot
  description: 'If temperature in the fuse box goes above 30°C for 30 seconds,

    sends urgent warning to open the fuse box door for ventilation.

    '
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.fuse_box_temperature
    above: 30
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition: []
  action:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ⚠️ Fuse box too hot
      message: Above 30°C. Open the door now!
  mode: single
- id: '1727527671553'
  alias: Remind about open windows when leaving
  description: 'When you leave home, checks if any windows or doors are open.

    Sends list of what''s still open so you can go back if needed.

    '
  trigger:
  - platform: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
    event: leave
  condition:
  - condition: template
    value_template: "{% set open_windows = \n  states.binary_sensor \n  | selectattr('attributes.device_class',
      'eq', 'opening')\n  | selectattr('state', 'eq', 'on')\n  | map(attribute='name')\n
      \ | list %}\n{{ open_windows | length > 0 }}\n"
  action:
  - data:
      title: "\U0001FA9F Open Door/Window Alert"
      message: "{% set open_windows = \n  states.binary_sensor \n  | selectattr('attributes.device_class',
        'eq', 'opening')\n  | selectattr('state', 'eq', 'on')\n  | map(attribute='name')\n
        \ | map('replace', ' Opening', '')\n  | list %}\nCheck these doors or windows:
        {{ open_windows | join(', ') }}\n"
    action: notify.mobile_app_jean_pauls_iphone
- id: '1727604574614'
  alias: Safety check at 3am if still awake
  description: 'If at 3am you''re still marked as awake, sends notification and automatically

    marks you asleep and turns off all lights. Prevents staying up too late.

    '
  triggers:
  - at: 03:00:00
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.awake
    state: 'on'
  - condition: state
    entity_id: person.jean_paul
    state: home
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    data:
      title: "\U0001F634 Still awake at 3am"
      message: Auto-turning off lights now.
  - action: input_boolean.turn_off
    entity_id: input_boolean.awake
  - action: light.turn_off
    entity_id: light.all_lights
    data:
      transition: 5
  mode: single
- id: '1727613739758'
  alias: Weekly cleanup tasks Sunday night
  description: 'Every Sunday at 2am, performs maintenance tasks:

    clears cached voice files and regenerates the README documentation.

    '
  trigger:
  - platform: time
    at: 02:00:00
  condition:
  - condition: time
    weekday:
    - sun
  action:
  - action: tts.clear_cache
    metadata: {}
    data: {}
  - action: readme.generate
    metadata: {}
    data: {}
  mode: single
- id: '1727725703135'
  alias: Turn on bedroom light when you enter
  description: 'Automatically turns bedroom light on when you enter,

    and off when you leave. Adjusts brightness based on available daylight.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.bedroom_occupancy
      light_switch:
        entity_id: light.bedroom
      time_delay: 3
      include_light_control:
      - use_brightness
      - use_transition
      light_transition_off: 10
      light_brightness: 80
      include_night_lights: night_lights_enabled
      night_lights_conditions:
      - sun_enabled
      night_lights:
        entity_id: light.bedroom
      night_time_delay: 3
      include_night_light_control:
      - use_brightness
      - use_transition
      night_light_transition_off: 5
      include_device_tracker: device_tracker_disabled
      people: []
      include_sun: sun_disabled
      include_bypass:
      - bypass_enabled_turn_off
      motion_bypass_lights_off:
      - switch.awake_reversed
      light_colour_temperature: 2480
      include_light_colour_control: use_colour_temperature
      include_night_light_colour_control: use_colour_temperature
      night_light_colour_temperature: 2480
      include_dynamic_lighting: enable_lux_controled_brightness
      night_lights_entity_state:
      - input_boolean.awake
      include_ambient: ambient_enabled
      ambient_light_options: ambient_light_option_enabled
      dynamic_lighting_lux_sensor: sensor.bedroom_illuminance
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_bedroom
      dynamic_lighting_max_brightness: 80
      dynamic_lighting_max_lux: 60
      ambient_light_sensor: sensor.bedroom_illuminance
      ambient_light_high_value: 60
- id: '1727772192031'
  alias: Bright workplace light during video calls
  description: 'When you join a video call, turns on bright workplace light.

    Turns it back off when call ends. Only activates if room is dark.

    '
  triggers:
  - entity_id:
    - input_select.microsoft_teams_presence
    to: In a Call
    id: to-in-a-call
    trigger: state
  - entity_id:
    - input_select.microsoft_teams_presence
    id: from-in-a-call
    from: In a Call
    trigger: state
  - entity_id:
    - input_select.microsoft_teams_presence
    id: from-in-a-call
    trigger: state
    to: Available
  conditions: []
  actions:
  - if:
    - condition: and
      conditions:
      - condition: trigger
        id:
        - to-in-a-call
      - condition: numeric_state
        entity_id: sensor.living_room_window_illuminance
        below: 3000
    then:
    - action: light.turn_on
      metadata: {}
      data:
        brightness_pct: 100
        kelvin: 6500
      target:
        entity_id: light.living_room_workplace
  - if:
    - condition: trigger
      id:
      - from-in-a-call
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: light.living_room_workplace
    else: []
  mode: single
- id: '1727940385271'
  alias: Friday afternoon vacuum cleaning offer
  description: 'Every Friday at 4pm if you''re home, sends notification asking

    which room you''d like to vacuum clean. You can choose from a list.

    '
  triggers:
  - trigger: time
    at: '16:00:00'
  conditions:
  - condition: time
    weekday:
    - fri
  - condition: state
    entity_id: person.jean_paul
    state: home
  actions:
  - alias: Set up variables for the actions
    variables:
      action_vacuum: "{% set options = state_attr('input_select.vacuum_room', 'options')
        %} {% set id = context.id %} [{% for option in options if option != 'Select
        a room...' %}\n  {% if not loop.first %}, {% endif %}\n  {\"action\": \"VACUUM_{{
        option|replace(' ', '-') }}_{{ id }}\", \"title\": \"{{ option }}\" }\n{%
        endfor %}]\n"
  - alias: Send notification to start vacuum cleaning
    data:
      message: Do you want to start vacuum cleaning?
      data:
        actions: '{{ action_vacuum }}'
    action: notify.mobile_app_jean_pauls_iphone
  - alias: Wait for a response
    wait_for_trigger:
    - event_type: mobile_app_notification_action
      trigger: event
      event_data: {}
    timeout:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - alias: Set up variables for the response
    variables:
      selected_action: '{{ wait.trigger.event.data.action }}'
      selected_room: '{{ selected_action.split(''_'')[1] | replace(''-'', '' '') }}'
      message_id: '{{ selected_action.split(''_'')[-1] }}'
    enabled: true
  - alias: Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ true }}'
      sequence:
      - alias: OK
        data:
          message: OK, starting action '{{ selected_room }}'
        action: notify.mobile_app_jean_pauls_iphone
      - action: input_select.select_option
        metadata: {}
        data:
          option: '{{ selected_room }}'
        target:
          entity_id: input_select.vacuum_room
    default:
    - alias: NOT OK
      data:
        message: '"Couldn''t determine action. Raw input is {{ message_id }} {{ wait.trigger.event.data}}"'
      action: notify.mobile_app_jean_pauls_iphone
- id: '1728032596562'
  alias: Gradual bedroom light at alarm time
  description: '15 minutes before alarm, gradually brightens bedroom light like sunrise.

    Only works if you''re home and alarm is enabled.

    '
  use_blueprint:
    path: DevSecNinja/wake-up-light-with-sunrise.yaml
    input:
      light_entity: light.bedroom
      timestamp_sensor: sensor.sonos_alarm_1_timestamp
      check_entity:
      - person.jean_paul
      - switch.sonos_alarm_1
      - switch.awake_reversed
      alarm_status_entity: switch.sonos_alarm_1
      start_brightness: 1
      sunrise_duration: 15
      post_sunrise_actions:
      - action: notify.mobile_app_jean_pauls_iphone
        metadata: {}
        data:
          message: ☀️ Good morning!
      pre_sunrise_actions: []
- id: '1728284888024'
  alias: Offer to pause alarm if already awake
  description: 'If bedroom music starts playing at alarm time but you''re already
    awake,

    sends notification asking if you want to pause the music.

    '
  triggers:
  - trigger: time
    at: sensor.sonos_alarm_1_timestamp
  conditions:
  - condition: state
    entity_id: input_boolean.wakeup_enabled
    state: 'on'
  - condition: state
    entity_id: input_boolean.awake
    state: 'on'
  actions:
  - delay:
      hours: 0
      minutes: 1
      seconds: 5
      milliseconds: 0
  - if:
    - condition: state
      entity_id: media_player.bedroom
      state: playing
    then:
    - action: notify.mobile_app_jean_pauls_iphone
      metadata: {}
      data:
        title: "\U0001F3B5 Music still playing"
        message: Pause it?
        data:
          actions:
          - action: PAUSE_SONOS
            title: Pause music
  mode: single
- id: '1728385114222'
  alias: Morning weather when unplugging phone
  description: 'If you unplug your phone in morning before getting up,

    sends weather forecast with radar image. Assumes you''re checking before rising.

    '
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.jean_paul_s_iphone_charging
    to: 'off'
    from: 'on'
  conditions:
  - condition: time
    after: 05:00:00
    before: '11:00:00'
  - condition: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
  - condition: state
    entity_id: input_boolean.awake
    state: 'off'
  - alias: Check if recently triggered
    condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(state_attr(this.entity_id,
      ''last_triggered'')) > 60 }}'
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ☀️ Good morning
      message: '{{ states(''sensor.temperature'') | round(0) }}°C, {{ states(''sensor.full_condition'')
        | lower }}.'
      data:
        entity_id: camera.buienradar
  mode: single
- id: '1728493873160'
  alias: Reset light timers when leaving or sleeping
  description: 'When you leave home or go to sleep, cancels any running light timers

    so automations work normally again when you return or wake.

    '
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.awake
    to: 'off'
  - trigger: state
    entity_id:
    - person.jean_paul
    from:
    - home
  conditions: []
  actions:
  - action: timer.cancel
    target:
      entity_id: timer.pause_the_automation_living_room_light
    data: {}
  mode: single
- id: '1728566997078'
  alias: Alert if electricity meter stops working
  description: 'If the electricity meter stops reporting for 10 minutes,

    sends notification to fix it by recreating the connection.

    '
  triggers:
  - trigger: state
    entity_id:
    - sensor.electricity_meter_energy_consumption_tarif_1
    - sensor.electricity_meter_energy_consumption_tarif_2
    to: unavailable
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: time_pattern
    minutes: /30
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.electricity_meter_energy_consumption_tarif_1
      state: unavailable
    - condition: state
      entity_id: sensor.electricity_meter_energy_consumption_tarif_2
      state: unavailable
    - condition: state
      entity_id: sensor.electricity_meter_active_tariff
      state: unavailable
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      message: Energy meter became unavailable. Fix it now by recreating the device
        in the integration and select DSMR 4
  mode: single
- id: '1729122821769'
  alias: Alert if car recall announced
  description: 'If a new recall is announced for your car,

    sends notification so you can schedule a fix appointment.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.mercedes_benz_jjr91v_pending_recall
    to:
    - 'on'
    from:
    - 'off'
  conditions: []
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ⚠️ New KIA recall
      message: Schedule a fix for your EV6.
  mode: single
- id: '1730047989947'
  alias: Daily chore reminder at 12:30pm
  description: 'Every day at 12:30pm if you''re home,

    reminds you to pick and do a household chore.

    '
  triggers:
  - trigger: time
    at: '12:30:00'
  conditions:
  - condition: state
    entity_id: person.jean_paul
    state: home
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F9F9 Chore time"
      message: Pick one and do it.
  mode: single
- id: '1730059015682'
  alias: Vacuum cleaning while alarm armed away
  description: 'If vacuum starts while alarm is armed away/vacation, sends notification.

    Alerts when done. This needs fixing to properly handle alarm status.

    '
  triggers:
  - trigger: state
    entity_id:
    - vacuum.roborock_s4
    to: cleaning
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_vacation
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F916 Vacuum started"
      message: Alarm is armed. Will notify when done.
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - vacuum.roborock_s4
      to: docked
    timeout:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F916 Vacuum finished"
      message: Cleaning complete.
  mode: single
- id: '1730757243166'
  alias: Control bathroom with dimmer remote
  description: 'Wireless dimmer controls: lights on/off/brightness, bedroom music
    play/pause,

    and ventilation fan speed (up button). Multiple presses for different functions.

    '
  use_blueprint:
    path: sandervv/ZHA - Hue Dimmer Fully Configurable.yaml
    input:
      remote: 7984401ffea94afc9edc44b2aa4fe166
      button_on_short_press:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.bathroom
      button_down_short_press:
      - if:
        - condition: state
          entity_id: media_player.bedroom
          state: playing
        then:
        - action: media_player.media_pause
          metadata: {}
          data: {}
          target:
            entity_id: media_player.bedroom
        else:
        - action: script.play_spotify_playlist
          metadata: {}
          data:
            media_player: media_player.bedroom
      button_off_short_press:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 2
        target:
          entity_id: light.bathroom
        enabled: true
      button_up_short_press:
      - action: button.press
        metadata: {}
        data: {}
        target:
          entity_id: button.zehnder_comfofan_max_30
      button_on_long_press:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_step_pct: 10
        target:
          entity_id:
          - light.bathroom
      button_off_long_press:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_step_pct: -10
        target:
          entity_id:
          - light.bathroom
      button_up_double_press:
      - action: button.press
        metadata: {}
        data: {}
        target:
          entity_id: button.zehnder_comfofan_max_10
      button_up_long_press:
      - action: button.press
        metadata: {}
        data: {}
        target:
          entity_id: button.zehnder_comfofan_auto
- id: '1730924477984'
  alias: Suggest switching music to receiver when arriving
  description: 'If you arrive home with music playing on AirPods,

    sends reminder to switch playback to home receiver. Needs fixing.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.front_door_opening
    to: 'on'
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: arming
  - condition: state
    entity_id: media_player.spotify_jptjee
    state: playing
  - condition: state
    entity_id: media_player.spotify_jptjee
    attribute: source
    state: iPhone
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F3B5 Switch Spotify output"
      message: Switch to receiver?
  mode: single
- id: '1731253341756'
  alias: Turn on fan when bathroom gets humid
  description: 'When humidity rises quickly (showering), turns on bathroom fan.

    Keeps running until humidity drops back down. Prevents mold.

    '
  use_blueprint:
    path: Blackshome/bathroom-humidity-exhaust-fan.yaml
    input:
      trigger: sensor.bathroom_humidity_derivative
      fan_switch:
        entity_id: input_boolean.bathroom_shower
      bathroom_humidity_sensor: sensor.bathroom_humidity
- id: '1731350338636'
  alias: Play music while brushing teeth
  description: 'When electric toothbrush starts and you''re awake without music playing,

    automatically plays music in bedroom at low volume until brushing is done.

    '
  triggers:
  - trigger: state
    entity_id:
    - sensor.smart_series_7000_ad17
    to: running
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.awake
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.spotify_jptjee
        state: playing
  actions:
  - action: script.play_spotify_playlist
    metadata: {}
    data:
      media_player: media_player.bedroom
  - action: media_player.volume_set
    metadata: {}
    data:
      volume_level: 0.3
    target:
      entity_id: media_player.bedroom
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - sensor.smart_series_7000_ad17
      to: charging
    - trigger: state
      entity_id:
      - sensor.smart_series_7000_ad17
      to: selection menu
    timeout:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.bedroom
  mode: single
- id: '1731360427132'
  alias: Control ventilation when showering
  description: 'When shower turns on, sets ventilation to high for 30 minutes.

    When shower turns off, returns ventilation to automatic mode.

    '
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.bathroom_shower
    to: 'on'
    from: 'off'
    id: off-to-on
  - trigger: state
    entity_id:
    - input_boolean.bathroom_shower
    to: 'off'
    from: 'on'
    id: on-to-off
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - off-to-on
    then:
    - action: button.press
      metadata: {}
      data: {}
      target:
        entity_id: button.zehnder_comfofan_max_30
  - if:
    - condition: trigger
      id:
      - on-to-off
    then:
    - action: button.press
      metadata: {}
      data: {}
      target:
        entity_id: button.zehnder_comfofan_auto
  mode: single
- id: '1731849616751'
  alias: Show weather when opening front door
  description: 'When you open front door with alarm off, shows weather forecast after
    10 seconds.

    Helps you know what to expect outside. Won''t spam notifications.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.front_door_opening
    to: 'on'
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  - alias: Check if recently triggered
    condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(state_attr(this.entity_id,
      ''last_triggered'')) > 60 }}'
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ☀️ Weather update
      message: '{{ states(''sensor.temperature'') | round(0) }}°C: {{ states(''sensor.knmi_weather_forecast'')
        }}'
      data:
        entity_id: camera.buienradar
  mode: single
- id: '1731870242326'
  alias: Alert if temperature difference is large
  description: 'If living room and bathroom temperature differ by more than 2°C

    when it''s cold, reminds you to close a window or vent.

    '
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_and_bathroom_temperature_difference
    above: 2
  conditions:
  - condition: numeric_state
    entity_id: sensor.living_room_temperature
    below: 20
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001FA9F Temperature difference"
      message: '{{ states(''sensor.living_room_and_bathroom_temperature_difference'')
        }}°C gap. Close window or vent.'
  mode: single
- id: '1731879328368'
  alias: Pause bedroom music when showering
  description: 'When you turn on the shower and bedroom music is playing,

    automatically pauses it so you don''t miss any music or waste sound.

    '
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.bathroom_shower
    to: 'on'
  conditions:
  - condition: state
    entity_id: media_player.bedroom
    state: playing
  actions:
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.bedroom
  mode: single
- id: '1732475044483'
  alias: Turn off alarm when you arrive home
  description: 'When you arrive home with alarm armed, automatically disarms it

    and sends welcome home notification.

    '
  triggers:
  - trigger: state
    entity_id:
    - device_tracker.jeanpaulsiphone
    to: home
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: disarmed
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_home
  actions:
  - action: alarm_control_panel.alarm_disarm
    metadata: {}
    data: {}
    target:
      entity_id: alarm_control_panel.alarmo
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F513 Alarm off"
      message: Welcome home!
  mode: single
- id: '1732546364748'
  alias: Alert if floor heating monitor stops
  description: 'If floor heating meter hasn''t updated in 24 hours, sends alert at
    2am.

    Means the monitoring system needs attention.

    '
  triggers:
  - trigger: time
    at: 02:00:00
  conditions:
  - condition: template
    value_template: "{% set device_time = state_attr('sensor.water_warm_floor_heating',
      'device_date_time') %}  \n{% if device_time != 'unknown' %}  \n  {{ (as_timestamp(now())
      - as_timestamp(device_time)) > 86400 }}  \n{% else %}  \n  false  \n{% endif
      %}"
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F50C Floor Heating monitor stopped!"
      message: Have a look at the wmbusmeters integration as the meter readings are
        not being gathered.
  mode: single
- id: '1732650114550'
  alias: Bedtime reminder when alarm is soon
  description: 'If it''s less than 8 hours until your alarm, you''re awake with living
    room

    lights on, reminds you to go to bed for enough sleep.

    '
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.hours_until_wakeup
    below: 8
  conditions:
  - condition: state
    entity_id: device_tracker.jeanpaulsiphone
    state: home
  - condition: state
    entity_id: input_boolean.awake
    state: 'on'
  - condition: state
    entity_id: light.living_room
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_boolean.bathroom_shower
      state: 'on'
  - condition: state
    entity_id: input_boolean.wakeup_enabled
    state: 'on'
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F634 Time for bed"
      message: Your alarm is in less than 8 hours.
  mode: single
- id: '1733935570931'
  alias: Flight reminders at 72h, 30h, and 24h
  description: 'For upcoming flights in your calendar, sends reminders

    72 hours, 30 hours, and 24 hours before departure with location details.

    '
  triggers:
  - trigger: calendar
    entity_id: calendar.tripit
    event: start
    offset: '-72:0:0'
  - trigger: calendar
    entity_id: calendar.tripit
    event: start
    offset: '-30:0:0'
  - trigger: calendar
    entity_id: calendar.tripit
    event: start
    offset: '-24:0:0'
  conditions:
  - condition: template
    enabled: true
    value_template: '{{ ''[Flight]'' in trigger.calendar_event.description }}'
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "{% set start = trigger.calendar_event.start | as_datetime %}\n        {%
        set hours = ((start - now()).total_seconds() / 3600) | int %}\n        ✈️
        {{ hours }} hours before flight {{ trigger.calendar_event.summary }}!\n✈️
        {{ hours }} hours or less before flight {{ trigger.calendar_event.summary
        }}!"
      message: Departure location is {{ trigger.calendar_event.location }}
  mode: queued
  max: 10
- id: '1736006673890'
  alias: Turn on workplace light when computer active
  description: 'When your computer is being used, turns on workplace light.

    Brightness adjusts based on available daylight from window.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.jean_pauls_mac_mini_active
      light_switch:
        entity_id: light.living_room_workplace
      time_delay: 3
      include_light_control:
      - use_brightness
      - use_transition
      light_brightness: 75
      light_transition_off: 5
      light_transition_on: 5
      include_dynamic_lighting: enable_lux_controled_brightness
      dynamic_lighting_lux_sensor: sensor.living_room_window_illuminance
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_workplace
- id: '1739629434251'
  alias: Living room smart lighting control
  description: 'Manages living room lights based on: time of day, daylight levels,

    and whether lights should be on. Automatically adjusts brightness and color.

    '
  use_blueprint:
    path: Blackshome/smart-light.yaml
    input:
      light_switch:
        entity_id: light.living_room
      include_bypass:
      - bypass_enabled_turn_off
      bypass_lights_off:
      - binary_sensor.light_living_room_bypass_sensor
      night_lights_entity_state:
      - switch.light_living_room_night_light_scene
      night_lights_conditions:
      - entity_state_enabled
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: light.living_room
      include_night_light_control:
      - use_brightness
      - if_lights_are_on_adjust_when_crossing_over
      - use_transition
      night_light_brightness: 40
      night_light_transition_on: 10
      include_ambient:
      - ambient_low
      - ambient_high
      ambient_light_sensor: sensor.living_room_window_illuminance
      ambient_light_value: 1100
      ambient_light_value_off: 1200
      include_dynamic_lighting: enable_sun_elevation_colour_lux_brightness
      dynamic_lighting_max_brightness: 65
      dynamic_lighting_min_brightness: 20
      dynamic_lighting_max_lux: 1000
      dynamic_lighting_lux_sensor: sensor.living_room_window_illuminance
      dynamic_lighting_boolean: input_boolean.toggle_helper_automations_light_living_room
      dynamic_lighting_min_lux: 200
      dynamic_lighting_min_colour_temp: 2000
      dynamic_lighting_max_colour_temp: 2800
      night_boolean_scenes_scripts: input_boolean.toggle_helper_automations_light_living_room
      light_colour_temperature: 2800
      include_light_colour_control: use_colour_temperature
      night_light_colour_temperature: 2000
      include_night_light_colour_control: use_colour_temperature
      night_light_transition_off: 10
      dynamic_lighting_step_value: 10
- id: '1740773906383'
  alias: Dim living room light before waking up
  description: 'When you''re not marked as awake and enter living room,

    turns on lights at low brightness so you''re not blinded.

    '
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.living_room_occupancy
      light_switch:
        entity_id: light.living_room
      motion_bypass_lights_stop:
      - input_boolean.awake
      boolean_scenes_scripts: input_boolean.toggle_helper_automations_light_living_room_when_not_awake
      light_brightness: 30
      include_light_control:
      - use_brightness
      include_bypass:
      - bypass_enabled_stop
      time_delay: 10
- id: '1742730192109'
  alias: Mark as away if phone not detected
  description: 'If your iPhone hasn''t been detected by either the app or WiFi

    for over 5 minutes, marks you as away. Helps other automations work correctly.

    '
  triggers:
  - minutes: /1
    trigger: time_pattern
  conditions:
  - condition: template
    value_template: '{% set last_updated = states.device_tracker.jean_pauls_iphone_app.last_updated
      %} {% set time_diff = now() - last_updated %} {{ time_diff.total_seconds() >
      300 }}

      '
  - condition: state
    entity_id: device_tracker.jeanpaulsiphone
    state: not_home
  - condition: not
    conditions:
    - condition: state
      entity_id: person.jean_paul
      state: not_home
  actions:
  - data:
      title: Jean-Paul marked as away
      message: 'iPhone hasn''t updated in over 5 minutes and UniFi can''t find the
        device. Last update: {{ states.device_tracker.jean_pauls_iphone_app.last_updated
        }}'
    action: persistent_notification.create
    enabled: false
  mode: single
- id: '1747895911015'
  alias: Alert when internet stops working
  description: 'If DNS lookups or internet pings fail, records the time

    and sends alert that network is offline.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.1_1_1_1
    to: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.google_com
    to: 'off'
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    target:
      entity_id: input_datetime.last_internet_outtage
    data:
      timestamp: '{{ now().timestamp() }}'
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ⚠️ Internet down
      message: No connection right now.
  mode: single
- id: '1749062970357'
  alias: Alert when internet is back online
  description: 'When internet connection is restored, calculates how long it was down

    and sends notification with outage duration.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.1_1_1_1
    to: 'on'
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.google_com
    to: 'on'
    from: 'off'
  conditions: []
  actions:
  - variables:
      outage_start_str: '{{ states(''input_datetime.last_internet_outtage'') }}'
      outage_start_ts: "{% if outage_start_str in ['', 'unknown', 'unavailable'] %}\n
        \ 0\n{% else %}\n  {{ as_timestamp(outage_start_str) }}\n{% endif %}\n"
      outage_end_ts: '{{ as_timestamp(now()) }}'
      downtime_seconds: "{% if outage_start_ts | float > 0 %}\n  {{ (outage_end_ts
        - outage_start_ts) | int }}\n{% else %}\n  0\n{% endif %}\n"
      downtime_human: "{% set s = downtime_seconds | int %} {% if s <= 0 %}\n  unknown\n{%
        else %}\n  {% set h = s // 3600 %}\n  {% set m = (s % 3600) // 60 %}\n  {%
        if h > 0 %}{{ h }}h {{ m }}m{% else %}{{ m }}m{% endif %}\n{% endif %}\n"
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: ✅ Network back online
      message: "{% if outage_start_ts | int == 0 %}\n  Internet is back — outage start
        time not recorded. Downtime: {{ downtime_human }}.\n{% else %}\n  Internet
        is back. Outage started at {{ outage_start_ts | int | timestamp_custom('%Y-%m-%d
        %H:%M:%S', true) }} and lasted {{ downtime_human }}.\n{% endif %}\n"
  mode: single
- id: '1750105404218'
  alias: Reset bedroom speaker volume when paused
  description: 'When bedroom music pauses, automatically resets the volume

    to normal level so it''s not too loud next time.

    '
  triggers:
  - device_id: 55d556a10e644f19ae88705a6dfbf26f
    domain: media_player
    entity_id: a6113c453548a203a4b12b0a30617efe
    type: paused
    trigger: device
  conditions: []
  actions:
  - action: media_player.volume_set
    metadata: {}
    data:
      volume_level: 0.2
    target:
      device_id: 55d556a10e644f19ae88705a6dfbf26f
  mode: single
- id: '1753081891927'
  alias: Pause music when tapping notification button
  description: 'When you tap the ''Pause Sonos'' button in a notification,

    immediately pauses the bedroom speaker.

    '
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: PAUSE_SONOS
    trigger: event
  actions:
  - target:
      entity_id: media_player.bedroom
    action: media_player.media_pause
  mode: single
- id: '1756817698779'
  alias: Alert if ventilation system disconnects
  description: 'If connection to the ventilation system is lost for 5 minutes,

    sends alert so you can check what''s wrong.

    '
  triggers:
  - id: lost
    trigger: state
    entity_id:
    - binary_sensor.zehnder_comfofan_connection_status
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - id: restored
    trigger: state
    entity_id:
    - binary_sensor.zehnder_comfofan_connection_status
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    enabled: false
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: lost
      sequence:
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: ⚠️ Ventilation offline
          message: Connection lost.
    - conditions:
      - condition: trigger
        id: restored
      sequence:
      - action: notify.mobile_app_jean_pauls_iphone
        data:
          title: ✅ Ventilation back
          message: Connection restored.
  mode: single
- id: '1760433724481'
  alias: Boost ventilation if toilet occupied long
  description: 'If someone is in the toilet for more than 12 minutes,

    automatically increases ventilation.

    '
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.toilet_occupancy
    to: 'on'
    for:
      hours: 0
      minutes: 12
      seconds: 0
  conditions: []
  actions:
  - device_id: f21fa4c2d96e64696d0d9eef5a71dd48
    domain: button
    entity_id: d08ce03f5ba4c7440160ee85a015282a
    type: press
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F6BD Ventilation boost"
      message: Testing long toilet occupancy detection.
  mode: single
- id: '1762693568858'
  alias: Parking disc reminder at girlfriend's place
  description: 'When you arrive at your girlfriend''s place, reminds you

    to display the blue parking disc in your car window.

    '
  triggers:
  - trigger: zone
    entity_id: device_tracker.jjr91v_device_tracker
    zone: zone.girlfriend
    event: enter
  conditions: []
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F17F️ Blue parking disc! "
      message: Don’t forget it!
  mode: single
- id: '1767296976174'
  alias: Track carwash visits automatically
  description: 'When you arrive at the carwash and stay for 3 minutes,

    sends a welcome notification and records today as your last carwash visit.

    '
  triggers:
  - trigger: zone
    entity_id: device_tracker.jjr91v_device_tracker
    zone: zone.carwash_haarlem
    event: enter
  conditions:
  - condition: state
    entity_id: device_tracker.jjr91v_device_tracker
    state:
    - Carwash Haarlem
    for:
      hours: 0
      minutes: 3
      seconds: 0
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F697 At the carwash"
      message: Timer reset. Enjoy!
  - action: input_datetime.set_datetime
    metadata: {}
    target:
      entity_id: input_datetime.last_carwash
    data:
      date: '{{ now().date() }}'
  mode: single
- id: '1767358576022'
  alias: Remind to unplug finished charger
  description: 'When your car finishes charging but the charger is still connected,

    sends reminders every hour while you''re awake until you unplug it.

    '
  triggers:
  - entity_id: sensor.jjr91v_charging_status
    to: '1'
    trigger: state
  - hours: /1
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: sensor.jjr91v_charging_status
    state: '1'
  - condition: state
    entity_id: binary_sensor.jjr91v_charging_active
    state: 'off'
  - condition: state
    entity_id: input_boolean.awake
    state:
    - 'on'
  actions:
  - data:
      title: "\U0001F50C Unplug car charger"
      message: Charging done. Disconnect car now.
    action: notify.mobile_app_jean_pauls_iphone
  mode: single
- id: '1767389583265'
  alias: Arm alarm when visiting girlfriend
  description: 'When your car arrives at your girlfriend''s place and you''re not
    at home,

    automatically arms the alarm in vacation mode for extra security.

    '
  triggers:
  - trigger: zone
    entity_id: device_tracker.jjr91v_device_tracker
    zone: zone.girlfriend
    event: enter
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: person.jean_paul
      state:
      - home
  actions:
  - action: alarm_control_panel.alarm_arm_vacation
    metadata: {}
    data: {}
    target:
      device_id: f6971f9bc57d99343c938850ecc7482d
  mode: single
- id: '1767599293927'
  alias: Car climate started warming up
  description: 'When you turn on pre-climate control in your car, sends a notification
    after 5 seconds to let you know it''s working.

    '
  use_blueprint:
    path: Blackshome/notifications-and-announcements.yaml
    input:
      trigger_state: 'on'
      trigger_state_entity:
      - switch.jjr91v_pre_entry_climate_control
      include_notify: enable_mobile_app_notify
      notify_device:
      - 46543360583f3c2044f992f533f51051
      notify_title: "\U0001F697 Car warming up"
      notify_message: Climate control is on
      notify_tag: car-climate
      time_delay_state:
        hours: 0
        minutes: 0
        seconds: 5
      global_conditions:
      - condition: template
        value_template: '{{ trigger.from_state.state not in [''unknown'', ''unavailable'']
          }}'
- id: '1767770178500'
  alias: Car climate reached temperature
  description: 'When the car''s climate control turns off, sends a notification that
    it finished warming or cooling.

    '
  use_blueprint:
    path: Blackshome/notifications-and-announcements.yaml
    input:
      trigger_state: 'off'
      trigger_state_entity:
      - switch.jjr91v_pre_entry_climate_control
      include_notify: enable_mobile_app_notify
      notify_device:
      - 46543360583f3c2044f992f533f51051
      notify_title: ✅ Car ready
      notify_message: Temperature reached
      notify_tag: car-climate
      time_delay_state:
        hours: 0
        minutes: 0
        seconds: 0
      global_conditions:
      - condition: template
        value_template: '{{ trigger.from_state.state not in [''unknown'', ''unavailable'']
          }}'
- id: '1767815981437'
  alias: Auto-update system every 4 hours
  description: 'Checks every 4 hours if a minor system update is available. If you''re
    home and awake for at least 15 minutes, installs it automatically.

    '
  triggers:
  - trigger: time_pattern
    hours: /4
  conditions:
  - condition: state
    entity_id: update.home_assistant_core_update
    state: 'on'
  - condition: template
    value_template: '{{ state_attr("update.home_assistant_core_update", "installed_version").split(".")[0:2]
      == state_attr("update.home_assistant_core_update", "latest_version").split(".")[0:2]
      }}'
  - condition: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
  - condition: state
    entity_id: input_boolean.awake
    state:
    - 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F47E System updating"
      message: Updating from {{ state_attr('update.home_assistant_core_update', 'installed_version')
        }} to {{ state_attr('update.home_assistant_core_update', 'latest_version')
        }}
  - action: update.install
    target:
      entity_id: update.home_assistant_core_update
    data: {}
  mode: single
- id: '1767816500000'
  alias: Ask before installing big updates
  description: 'Checks twice a day if a big system update is ready.

    If you''re home and awake, asks your permission before updating.

    You can tap to install now or postpone it for later.

    '
  triggers:
  - trigger: time_pattern
    hours: /12
  conditions:
  - condition: state
    entity_id: update.home_assistant_core_update
    state: 'on'
  - condition: template
    value_template: '{{ state_attr("update.home_assistant_core_update", "installed_version").split(".")[0:2]
      != state_attr("update.home_assistant_core_update", "latest_version").split(".")[0:2]
      }}'
  - condition: zone
    entity_id: device_tracker.jean_pauls_iphone_app
    zone: zone.home
  - condition: state
    entity_id: input_boolean.awake
    state:
    - 'on'
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F680 Major system update available"
      message: Update from {{ state_attr('update.home_assistant_core_update', 'installed_version')
        }} to {{ state_attr('update.home_assistant_core_update', 'latest_version')
        }} is available. Install now?
      data:
        actions:
        - action: INSTALL_MAJOR_UPDATE
          title: Install Now
        - action: DISMISS_UPDATE
          title: Later
  mode: single
- id: '1767816500001'
  alias: Install update after you approve
  description: 'When you tap Install Now on the update notification,

    the system updates itself and sends a confirmation message.

    '
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: INSTALL_MAJOR_UPDATE
    trigger: event
  conditions:
  - condition: state
    entity_id: update.home_assistant_core_update
    state: 'on'
  actions:
  - action: notify.mobile_app_jean_pauls_iphone
    metadata: {}
    data:
      title: "\U0001F47E Installing major update"
      message: Updating from {{ state_attr('update.home_assistant_core_update', 'installed_version')
        }} to {{ state_attr('update.home_assistant_core_update', 'latest_version')
        }}
  - action: update.install
    target:
      entity_id: update.home_assistant_core_update
    data: {}
  mode: single
- id: '1768033398320'
  alias: Finish living room lights timer when leaving home or sleeping
  description: Finishes the timer that is used by the Living Room light automation
    to ensure the living room light turns on when coming back home or out of awake
    mode
  triggers:
  - trigger: zone
    entity_id: person.jean_paul
    zone: zone.home
    event: leave
  - trigger: state
    entity_id:
    - input_boolean.awake
    from:
    - 'on'
    to:
    - 'off'
  conditions: []
  actions:
  - action: timer.finish
    metadata: {}
    target:
      entity_id: timer.pause_the_automation_living_room_light
    data: {}
  mode: single
